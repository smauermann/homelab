service:
  type: 'ClusterIP'
  port: 80

ingress:
  enabled: true
  className: cilium

  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    gethomepage.dev/description: SSO
    gethomepage.dev/enabled: "true"
    gethomepage.dev/group: Auth
    gethomepage.dev/icon: authelia.png
    gethomepage.dev/name: Authelia
  tls:
    enabled: true
    secret: 'authelia-tls'

    hostNameOverride: authelia.costanza.cloud

pod:
  # Must be Deployment, DaemonSet, or StatefulSet.
  kind: Deployment

  replicas: 1
  revisionHistoryLimit: 3

  strategy:
    type: Recreate

  env:
  - name: 'TZ'
    value: 'Europe/Berlin'
  - name: AUTHELIA_SESSION_REDIS_PASSWORD_FILE
    value: /secrets/valkey-secret/password

  resources:
    limits:
      memory: 125Mi
    requests:
      memory: 25Mi

configMap:
  log:
    ## Level of verbosity for logs: info, debug, trace.
    level: 'info'

  theme: auto

  identity_validation:
    reset_password:
      secret:
        secret_name: encryption-keys

  ## The available providers are: `file`, `ldap`. You must use one and only one of these providers.
  authentication_backend:
    file:
      enabled: true
      path: /secrets/users/users.yaml

  access_control:
    default_policy: one_factor
    rules:
      - domain: '*.costanza.cloud'
        policy: one_factor

  session:
    encryption_key:
      secret_name: encryption-keys

    cookies:
      - subdomain: authelia
        domain: costanza.cloud
        default_redirection_url: https://homepage.costanza.cloud

    redis:
      enabled: true
      host: 'authelia-valkey-master.authelia.svc.cluster.local'
      port: 6379
      password:
        disabled: true

  ## The available providers are: `local`, `mysql`, `postgres`. You must use one and only one of these providers.
  storage:
    encryption_key:
      secret_name: encryption-keys

    ## This stores the data in a SQLite3 Database.
    ## This is only recommended for lightweight non-stateful installations.
    local:
      enabled: true
      path: /config/db.sqlite3

    ## PostgreSQL (Storage Provider)
    postgres:
      enabled: false

  notifier:
    filesystem:
      enabled: true
      filename: '/config/notification.txt'

  identity_providers:
    oidc:
      enabled: true
      hmac_secret:
        secret_name: encryption-keys

      ## The JWK's issuer option configures multiple JSON Web Keys. It's required that at least one of the JWK's
      ## configured has the RS256 algorithm. For RSA keys (RS or PS) the minimum is a 2048 bit key.
      jwks:
        - key_id: 'default'
          algorithm: 'RS256'
          use: 'sig'
          key:
            value: |
             -----BEGIN PRIVATE KEY-----
             MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCm2CjVojtqINxa
             MHL/tMcx7k2+NTB7Qug2JCgtTSClHEa7TBrGcMGXt1uTA0aaoj1UwT2b7hYeTakW
             Y9T7DC1Tk/sl2NeveiDeMuNu8C/bsKqPRn3H65DKPrYUuz+4Yuo8tG+P6dJ16TqC
             ITtX2YuIAkOddk35eTkldtqI/tOATytzHe/EpuqFNBKrsCcMSSVhXiwxzoezaxYD
             ITVbvtTdUXyM0hRsEtQO2YUhHQ/7pBwC9K73114pDaVjX6W8/bkuVn5GzHxZz75P
             oImPSXG2NM/FPeL9Phby5HaiBIQHzGHsvlgQbgO1aCzxcxU8fl9L523FHXeSXWuZ
             1FtiVXSjAgMBAAECggEALMPysN9GccM/XDODp3gpugvmcBJ1X50kEOLCpOT8zVA4
             6igRRw0Z5EseFuPaHcNKEWOH1D6dUKQlqgw/KNyrjLE3wX/c3wg1qWid/TYUoS1V
             lfuj4/AgeSM6V3WmMyLXFlKTXFmwTlK1kBS6h2enOGbjHWyQn08XNiYdnIRC2znz
             nEpOkj8mZpbYO8zkbcAglWabZVR8hRVkPJmMBR5f3p4JduLM2z9veJqfaz4i24P+
             GHJ0jv117X13kTPepjmlZeeJ/q3rz3kG1gIbG6kUI6S4y7e1YXxeIuBSAwEu2B0R
             73EXH7yXdDwzX5evh0+hvfxlD2wFjv/VnrUfzSb0gQKBgQDBw+uQvSaLhEKLzajm
             BlA+O7kUGjkjwoowtTzUoZ79612Uadt4zkFAFnqZH10urLrW+T+9gWRb6INjFzQZ
             ywoT9L5jGCj+nnQ3f05GQNm6mstxwAc2jlHmbj0wnDKmL68QcO4nGudpKflgu5ZX
             5rojRDndnMb5c+JJE4v0q0Jm5QKBgQDcbrP1yoEtTdp7pdC+MIimit5isReTjdoB
             OluEYtqViHY8J+jPW3wqkJDjEdugpMQXqqjfvQAZJ1VO5UcJHo4l0FmuE4ChaNOh
             naS1A157DniPZaSa1DnDg4LdJtnCdHnhuUPdya3dnnsIXrLSx6+ao07yDYi8J0EQ
             16ex69ps5wKBgQC+VGu0/ge5rc4MM5T/dh4mM1YGaAfOl45UcAJzvtpFA4gle6Ho
             1XkEsc/1TviiG2tgNO8mf84L9aXxlN5Jo8afeZ32Csph6VWxGezSV2tHwDus3Xp4
             XW4Xkhuq/xNFaLtmw/c7FFNRWriqCzmP2ITolWDdzd0pNWqGa5vjVsJf/QKBgEpp
             5L6Y+jq9CYCsXWeXIsp2HtTaS8c4H9xCQxrR9FB+nMt5/ZHipGwKGZ9OLAJzHO+Q
             YSoGt73GFXpo1C4z7nC9gUjOtKHIrYjlmvCwjnikTfa6rXLHKijigI7/yotmnq6g
             yFRa/SLPmWEd9uhJGPLvJnt4Liy2Y7S32JirsjUJAoGAbsE1qWo8Y0zEeFsaP2/m
             V6v+Cyjay2AtnIxOJ2PbbNseRaewdn+aUg13Gq9f9NypG9mW3FCxFCqo5ouV2hvW
             pEbriVdTgj9pbhor3R+mnspYCLKCd4inEt+1GILkDE2y5i6v4Kf+LeFRA0oKoa9+
             HQrPu5bJivMa0g6yCZtozGQ=
             -----END PRIVATE KEY-----


      clients:
        - client_id: argocd
          client_name: ArgoCD
          authorization_policy: 'one_factor'
          client_secret:
            value: '$pbkdf2-sha512$310000$58llqO7ShKozm511n8.StQ$3sgoW44QGH47mJI73fZz7ihSDQajUr.g7Bt2UVz8ZqtqhWdv5AZ067.iAp2fZMSvkxTUO.TuGpHpE/fq.SBqag'
          public: false
          redirect_uris:
            - https://argocd.costanza.cloud/auth/callback
            - https://argocd.costanza.cloud/applications
          scopes:
            - 'openid'
            - 'groups'
            - 'email'
            - 'profile'
          userinfo_signed_response_alg: 'none'
          consent_mode: 'auto'
          pre_configured_consent_duration: '30 days'

secret:
  additionalSecrets:
    users: {}
    valkey-secret: {}
    encryption-keys:
      items:
        - key: identity_providers.oidc.hmac.key
          path: identity_providers.oidc.hmac.key
        - key: identity_validation.reset_password.jwt.hmac.key
          path: identity_validation.reset_password.jwt.hmac.key
        - key: session.encryption.key
          path: session.encryption.key
        - key: storage.encryption.key
          path: storage.encryption.key
