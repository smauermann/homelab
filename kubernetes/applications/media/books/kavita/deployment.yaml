apiVersion: apps/v1
kind: Deployment
metadata:
  name: kavita
spec:
  selector: {}
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 2501
        runAsGroup: 2501
        fsGroup: 2501
        fsGroupChangePolicy: OnRootMismatch
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: kavita
        image: ghcr.io/kareadita/kavita:latest # renovate: docker=ghcr.io/kareadita/kavita
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: [ "ALL" ]
        envFrom:
          - configMapRef:
              name: common-env
        env:
          - name: DOTNET_SYSTEM_GLOBALIZATION_INVARIANT
            value: "true"
        ports:
          - name: http
            containerPort: 5000
        volumeMounts:
          - name: config
            mountPath: /kavita/config
          - name: media
            mountPath: /mnt/media
      volumes:
      - name: config
        persistentVolumeClaim:
          claimName: kavita-config
      - name: media
        persistentVolumeClaim:
          claimName: books-media-nfs
