controllers:
  garage:
    containers:
      app:
        image:
          repository: dxflrs/garage
          tag: v2.2.0@sha256:45a61ce3f7c9c24fc23d9ed2b09b27ed560ab87b34605d175d5c588f539c24e4
        env:
          TZ: "Europe/Berlin"
        envFrom:
          - secretRef:
              name: garage
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: [ALL]
        resources:
          requests:
            cpu: 100m
          limits:
            memory: 5Gi

defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch

service:
  app:
    ports:
      s3:
        port: &port 3900
      api:
        port: 3903

route:
  app:
    hostnames:
      - s3.costanza.cloud
    parentRefs:
      - name: private
        namespace: envoy-gateway-system
    rules:
      - backendRefs:
          - name: garage
            port: *port

persistence:
  config:
    enabled: true
    type: configMap
    name: garage-config
    globalMounts:
      - path: /etc/garage.toml
        subPath: configuration.toml
  data:
    type: nfs
    server: nas.internal
    path: /volume1/homelab/garage/data
    globalMounts:
      - path: /data
  meta:
    type: nfs
    server: nas.internal
    path: /volume1/homelab/garage/meta
    globalMounts:
      - path: /meta
